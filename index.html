<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Crypt : Store and retrieve encrypted configuration parameters from etcd or consul">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Crypt</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/bketelsen/crypt">View on GitHub</a>

          <h1 id="project_title">Crypt</h1>
          <h2 id="project_tagline">Store and retrieve encrypted configuration parameters from etcd or consul</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/bketelsen/crypt/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/bketelsen/crypt/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Watch Kelsey explain <code>crypt</code> in this quick 5 minute video:
<a href="https://www.youtube.com/watch?v=zYpqqfuGwW8&amp;list=UUpoYiy3kgOBELDOwIDEdnpg"><img src="http://img.youtube.com/vi/zYpqqfuGwW8/0.jpg" alt="Crypt Demonstration Video"></a></p>

<p><strong>Fess up.</strong>
You have passwords and usernames hard coded in your apps.  You have IP addresses checked in to your source code repository.  You have entire configuration files that were created by the developer who wrote the app and haven't been changed since she typed <code>git init</code>. </p>

<h1>
<a name="crypt" class="anchor" href="#crypt"><span class="octicon octicon-link"></span></a>crypt</h1>

<p><code>crypt</code> is here to lead you back to the Path of Enlightened Configuration.  Store encrypted configuration values in <a href="https://github.com/coreos/etcd">etcd</a> or <a href="http://www.consul.io/">consul</a> using a command line application.</p>

<p>Decrypt them before starting your application using a wrapper script and the handy CLI tool, or inside the app using the <code>crypt/config</code> library.</p>

<h2>
<a name="standards" class="anchor" href="#standards"><span class="octicon octicon-link"></span></a>Standards</h2>

<p><code>crypt</code> is built on time-tested standards like OpenPGP, base64, and gzip.  Your data is encrypted using public key encryption, and can only be decrypted by when the private key is available.  After compression, it is encrypted, and base64 encoded so it can be stored in your key/value store of choice.  We support etcd and consul out of the box, but adding other storage tools is a trivial task, thanks to Go's interfaces.</p>

<h2>
<a name="how-it-works" class="anchor" href="#how-it-works"><span class="octicon octicon-link"></span></a>How it works</h2>

<p><code>crypt</code> compresses, encrypts, then encodes your value for storage, then puts it at the location you specify on your key/value store.  To encrypt, you'll need access to one or more public keys.</p>

<p>In order to decrypt a value, your application will need access to the private key.  We recommend putting the private key on the server and protecting it with standard host level security.  Then make sure your application runs under the context of a named user on your system, and that user is the only user with access to the private key(ring).  If you're running within Docker, just mount a volume from the directory with the private key.  ** Don't put your private key in your Docker container.  Seriously.  Just don't. **</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>You can use crypt as a command line tool or as a configuration library:</p>

<ul>
<li><a href="https://github.com/bketelsen/crypt/tree/master/bin/crypt">crypt cli</a></li>
<li><a href="https://github.com/bketelsen/crypt/tree/master/config">crypt/config</a></li>
</ul>

<h2>
<a name="generating-gpg-keys-and-keyrings" class="anchor" href="#generating-gpg-keys-and-keyrings"><span class="octicon octicon-link"></span></a>Generating gpg keys and keyrings</h2>

<p>The crypt cli and config package require gpg keyrings.  ** Read about them <a href="https://www.gnupg.org/gph/en/manual.html">here</a> before you blindly follow a tutorial written by someone you don't know and shouldn't trust. **</p>

<h3>
<a name="create-a-key-and-keyring-from-a-batch-file" class="anchor" href="#create-a-key-and-keyring-from-a-batch-file"><span class="octicon octicon-link"></span></a>Create a key and keyring from a batch file</h3>

<pre><code>vim myapp.batch
</code></pre>

<pre><code>%echo Generating a configuration OpenPGP key
Key-Type: default
Subkey-Type: default
Name-Real: myapp
Name-Comment: myapp configuration key
Name-Email: app@example.com
Expire-Date: 0
%pubring .pubring.gpg
%secring .secring.gpg
%commit
%echo done
</code></pre>

<p>Run the following command:</p>

<pre><code>gpg2 --batch --armor --gen-key myapp.batch
</code></pre>

<p>You should now have two keyrings, <code>.pubring.gpg</code> which contains the public keys, and <code>.secring.gpg</code> which contains the private keys.  This is a place where you can get fancy -- create different keyrings for different environments.  Make one for your production environment that the developers don't have access to.  Remember <a href="http://www.sans.edu/research/security-laboratory/article/it-separation-duties">separation of duties</a> to keep your data safe.</p>

<blockquote>
<p>Note the private key is not protected by a passphrase.</p>
</blockquote>

<h2>
<a name="create-a-configuration-key" class="anchor" href="#create-a-configuration-key"><span class="octicon octicon-link"></span></a>Create a configuration key</h2>

<p>You can encrypt a single value, or an entire configuration file.  <code>crypt</code> will read the contents of the file you specify and encrypt it, then store it in your data store.</p>

<p>** Keep your configuration values atomic ***
Don't set the database username in one key and the password in another key.  Most k/v stores don't support transactions, so you might get the change to one, but not the other.  Instead, keep related configurations together in a single file, and write/read them atomically.</p>

<p>Here's how to encrypt a file called <code>config.json</code> and store it at /myapp/config in etcd:</p>

<pre><code>crypt set -backend etcd -endpoint http://127.0.0.1:4001 -keyring pubring.gpg /myapp/config config.json 
</code></pre>

<p>To retrieve it on the command line:</p>

<pre><code>crypt get -backend etcd -endpoint http://127.0.0.1:4001 -keyring pubring.gpg &gt; config.json
</code></pre>

<p>Or inside your application:</p>

<pre><code>package main

import (
    "fmt"
    "log"
    "os"

    "github.com/bketelsen/crypt/config"
)

var (
    key           = "/myapp/config"
    secretKeyring = ".secring.gpg"
)

func main() {
    kr, err := os.Open(secretKeyring)
    if err != nil {
        log.Fatal(err)
    }
    defer kr.Close()
    machines := []string{"http://127.0.0.1:4001"}
    cm, err := config.NewEtcdConfigManager(machines, kr)
    if err != nil {
        log.Fatal(err)
    }
    value, err := cm.Get(key)
    if err != nil {
        log.Fatal(err)
    }
    // now use the data
    //fmt.Printf("%s\n", value)
    // var config MyConfigStruct
    // err := json.Unmarshal(value, &amp;config)
}
</code></pre>

<h3>
<a name="security-note" class="anchor" href="#security-note"><span class="octicon octicon-link"></span></a>Security Note</h3>

<p>Remember your data is only as secure as your private key.  Do some research and figure out a safe and secure way to keep your key away.</p>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>We'll happily accept contributions for new storage backends (mongodb?) and link to library implementations in other languages.  Fork, and send a clean PR in a new branch.  </p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2014 XOR Data Exchange, Inc.</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Crypt maintained by <a href="https://github.com/bketelsen">bketelsen</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-55882461-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
